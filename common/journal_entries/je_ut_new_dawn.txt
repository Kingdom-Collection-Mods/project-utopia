je_ut_new_dawn = {
	icon = "gfx/interface/icons/event_icons/event_protest.dds"

	group = je_group_utopia
	

	is_shown_when_inactive = {
		is_player = yes
		ut_service_workers_possible = yes
	}

	possible = {
		pop_type_percent_country = {
			pop_type = service_workers
			percent > 0.05
		}
	}

	modifiers_while_active = {
		new_dawn_ongoing
	}

	immediate = {
		ut_set_new_dawn_variables = yes
	}

	scripted_button = ut_new_dawn_fascist_focus
	scripted_button = ut_new_dawn_autocrat_focus
	scripted_button = ut_new_dawn_democrat_focus
	scripted_button = ut_new_dawn_communist_focus

	scripted_progress_bar = ut_new_dawn_fascist_bar
	scripted_progress_bar = ut_new_dawn_autocrat_bar
	scripted_progress_bar = ut_new_dawn_democrat_bar #ut_new_dawn_democrat_bar
	scripted_progress_bar = ut_new_dawn_communist_bar

	complete = {
		custom_tooltip = {
			text = je_ut_new_dawn_condition_tt
			has_variable = je_ut_new_dawn_done #Can only ever complete upon finishing the Cement the Rightful ideology journal entry.
		}
	}

	on_complete = {
		custom_tooltip = {
			text = je_ut_new_dawn_effect_tt
			ut_clear_divided_new_dawn_variables = yes #Removes all variables used for math in this JE, to save memory and performance.
		}
	}

	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = ut_new_dawn_democrat_status_je
				trigger = {	
					has_journal_entry = je_ut_new_dawn_democratic
				}
			}
			triggered_desc = { # In the lead and on the throne
				desc = ut_new_dawn_democrat_status
				trigger = {
					AND = {
						scope:journal_entry = { 
							"scripted_bar_progress(ut_new_dawn_democrat_bar)" > "scripted_bar_progress(ut_new_dawn_communist_bar)"
							"scripted_bar_progress(ut_new_dawn_democrat_bar)" > "scripted_bar_progress(ut_new_dawn_fascist_bar)" 
							"scripted_bar_progress(ut_new_dawn_democrat_bar)" > "scripted_bar_progress(ut_new_dawn_autocrat_bar)"
						}
					}
				}
			}
			triggered_desc = { # In the lead and on the throne
				desc = ut_new_dawn_fascist_status
				trigger = {
					AND = {
						scope:journal_entry = { 
							"scripted_bar_progress(ut_new_dawn_fascist_bar)" > "scripted_bar_progress(ut_new_dawn_communist_bar)"
							"scripted_bar_progress(ut_new_dawn_fascist_bar)" > "scripted_bar_progress(ut_new_dawn_democrat_bar)" 
							"scripted_bar_progress(ut_new_dawn_fascist_bar)" > "scripted_bar_progress(ut_new_dawn_autocrat_bar)"
						}
					}
				}
			}
			triggered_desc = {
				desc = ut_new_dawn_communist_status
				trigger = {
					scope:journal_entry = { 
						"scripted_bar_progress(ut_new_dawn_communist_bar)" > "scripted_bar_progress(ut_new_dawn_fascist_bar)"
						"scripted_bar_progress(ut_new_dawn_communist_bar)" > "scripted_bar_progress(ut_new_dawn_democrat_bar)"
						"scripted_bar_progress(ut_new_dawn_communist_bar)" > "scripted_bar_progress(ut_new_dawn_autocrat_bar)"
					}
				}
			}
			triggered_desc = {
				desc = ut_new_dawn_autocrat_status
				trigger = {
					scope:journal_entry = { 
						"scripted_bar_progress(ut_new_dawn_autocrat_bar)" > "scripted_bar_progress(ut_new_dawn_fascist_bar)"
						"scripted_bar_progress(ut_new_dawn_autocrat_bar)" > "scripted_bar_progress(ut_new_dawn_democrat_bar)"
						"scripted_bar_progress(ut_new_dawn_autocrat_bar)" > "scripted_bar_progress(ut_new_dawn_autocrat_bar)"
					}
				}
			}
		}
	}

	on_weekly_pulse = {
		events = {
			event_new_dawn.1
		}
		effect = {
			if = {
				limit = {
					NOT = {
						has_variable = ut_new_dawn_bar_freeze #This variable stops iteration, and is granted by reaching 480 with one ideology. It's reset when this JE is completed, or when je_cement_the_rightful_ideology fails.
					}
				}
				#Calculates how much the each core ideology will get next month. Updates weekly, but is not added until the monthly.
				ut_new_dawn_fascist_progress = yes 
				ut_new_dawn_democrat_progress = yes
				ut_new_dawn_communist_progress = yes
				ut_new_dawn_autocrat_progress = yes
			}
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					scope:journal_entry = { 
						OR = {
							"scripted_bar_progress(ut_new_dawn_fascist_bar)" >= new_dawn_core_upper_bound
							"scripted_bar_progress(ut_new_dawn_democrat_bar)" >= new_dawn_core_upper_bound
							"scripted_bar_progress(ut_new_dawn_communist_bar)" >= new_dawn_core_upper_bound
							"scripted_bar_progress(ut_new_dawn_autocrat_bar)" >= new_dawn_core_upper_bound
						}
					}
					NOT = {
						has_variable = ut_new_dawn_bar_freeze
					}
				}
				if = {
					limit = {
						scope:journal_entry = { 
							ut_ideology_new_dawn_focus_won = yes
						}
					}
					trigger_event = { id = event_new_dawn.2 popup = yes} #Reinforcement event - fires if the leading ideology is the one in power.
				}
				else = {
					trigger_event = { id = event_new_dawn.3 popup = yes} #Coup event - fires if the leading ideology is not the one in power.
				}
				ut_freeze_new_dawn_progress = yes #Freezes the bars so that they no longer accumulate progress on the monthly tick, and stay as they are. In the case that Cement the Rightful ideology fails, the bars will be set back.
			}
		}
		random_events = {
			400 = 0
			10 = event_new_dawn.11
			# 10 = french_pretenders_pulse.3
			# 50 = french_pretenders_pulse.10
			# 10 = french_pretenders_pulse.11
			# 10 = french_pretenders_pulse.12
			# 10 = french_pretenders_pulse.13
			# 10 = french_pretenders_pulse.14
			# 10 = french_pretenders_pulse.15
			# 10 = french_pretenders_pulse.16
			# 10 = french_pretenders_pulse.17
			# 10 = french_pretenders_pulse.18
		}
	}

	weight = 100

	should_be_pinned_by_default = yes
}

je_ut_new_dawn_democratic = {
	icon = "gfx/interface/icons/event_icons/event_protest.dds"

	group = je_group_utopia
	

	is_shown_when_inactive = {
		is_player = yes
		has_technology_researched = mass_propaganda
	}

	possible = {
		has_variable = ut_new_dawn_core_democrat_var
	}

	modifiers_while_active = {
		new_dawn_phase_2_ongoing
		je_ut_new_dawn_democratic
	}

	immediate = {
		ut_set_new_dawn_variables = yes
		
		remove_variable = ut_new_dawn_bar_freeze
	}
	
	scripted_button = je_ut_new_dawn_democratic_spirit
	scripted_button = je_ut_new_dawn_democratic_cultural_values
	scripted_button = je_ut_new_dawn_democratic_power_bloc
	scripted_button = je_ut_new_dawn_democratic_fair_elections

	
	scripted_progress_bar = je_ut_new_dawn_democratic_points_bar

	complete = {
		custom_tooltip = {
			text = je_ut_new_dawn_democratic_complete_condition_tt
			has_variable = je_ut_new_dawn_democratic_spirit_done
			has_variable = je_ut_new_dawn_democratic_cultural_values_done
			has_variable = je_ut_new_dawn_democratic_power_bloc_done
			has_variable = je_ut_new_dawn_democratic_fair_elections_done
		}
		
		custom_tooltip = {
			text = new_dawn_ideology_upper_bound_tt
			je:je_ut_new_dawn_democratic = { 
				"scripted_bar_progress(je_ut_new_dawn_democratic_points_bar)" >= new_dawn_ideology_upper_bound_tt
			}
		}
	}

	on_complete = {
		custom_tooltip = {
			text = je_ut_new_dawn_effect_tt
			ut_clear_divided_new_dawn_variables = yes #Removes all variables used for math in this JE, to save memory and performance.
		}
		set_variable = je_ut_new_dawn_done
	}

	status_desc = {
	}


	on_weekly_pulse = {
		events = {
			#event_new_dawn.1
		}
		effect = {
			ut_new_dawn_democrat_progress = yes
		}
	}

	on_monthly_pulse = {
		effect = {
		}
		random_events = {
			400 = 0
			# 10 = french_pretenders_pulse.2
		}
	}

	fail = {
		custom_tooltip = {
			text = je_ut_new_dawn_critical_lower_bound_fail_tt
			je:je_ut_new_dawn_democratic = { 
				"scripted_bar_progress(je_ut_new_dawn_democratic_points_bar)" <= new_dawn_ideology_critical_lower_bound
			}
		}
	}

	# effect which is executed when 'fail' trigger becomes true
	on_fail = {
	}

	weight = 100

	should_be_pinned_by_default = yes
}